---
title: "Reproducibility Report: Group B Choice 3"
output:
  html_document:
    toc: yes
    toc_float: yes
  pdf_document:
    toc: yes
---

-------

For this exercise, please try to reproduce the results from Experiment 2 of the associated paper (de la Fuente, Santiago, Roman, Dumitrache, & Casasanto, 2014). The PDF of the paper is included in the same folder as this Rmd file. 

#### Methods summary: 

Researchers tested the question of whether temporal focus differs between Moroccan and Spanish cultures, hypothesizing that Moroccans are more past-focused, whereas Spaniards are more future-focused. Two groups of participants ($N = 40$ Moroccan and $N=40$ Spanish) completed a temporal-focus questionnaire that contained questions about past-focused ("PAST") and future-focused ("FUTURE") topics. In response to each question, participants provided a rating on a 5-point Likert scale on which lower scores indicated less agreement and higher scores indicated greater agreement. The authors then performed a mixed-design ANOVA with agreement score as the dependent variable, group (Moroccan or Spanish, between-subjects) as the fixed-effects factor, and temporal focus (past or future, within-subjects) as the random effects factor. In addition, the authors performed unpaired two-sample t-tests to determine whether there was a significant difference between the two groups in agreement scores for PAST questions, and whether there was a significant difference in scores for FUTURE questions.

------

#### Target outcomes: 

Below is the specific result you will attempt to reproduce (quoted directly from the results section of Experiment 2):

> According to a mixed analysis of variance (ANOVA) with group (Spanish vs. Moroccan) as a between-subjects factor and temporal focus (past vs. future) as a within-subjectS factor, temporal focus differed significantly between Spaniards and Moroccans, as indicated by a significant interaction of temporal focus and group, F(1, 78) = 19.12, p = .001, ηp2 = .20 (Fig. 2). Moroccans showed greater agreement with past-focused statements than Spaniards did, t(78) = 4.04, p = .001, and Spaniards showed greater agreement with future-focused statements than Moroccans did, t(78) = −3.32, p = .001. (de la Fuente et al., 2014, p. 1685).

------

```{r global_options, include=FALSE}
knitr::opts_chunk$set(echo=TRUE, warning=FALSE, message=FALSE)
```

# Step 1: Load packages

```{r}
library(tidyverse) # for data munging
library(knitr) # for kable table formating
library(haven) # import and export 'SPSS', 'Stata' and 'SAS' Files
library(readxl) # import excel files

# #optional packages/functions:
library(afex) # anova functions
library(ez) # anova functions 2
# library(scales) # for plotting
# std.err <- function(x) sd(x)/sqrt(length(x)) # standard error
```

# Step 2: Load data

```{r}
# Just Experiment 2
data_path <- '/Users/as4508/Documents/GitHub/problem_sets/ps3/Group B/Choice 3/data/DeLaFuenteEtAl_2014_RawData-OSF-corrected_EHedit.xls'
d <- read_excel(data_path, sheet=3)
```

# Step 3: Tidy data

```{r}

names(d)
head(d)

d_tidy <- d %>%
  mutate(agreement = `Agreement (0=complete disagreement; 5=complete agreement)`,
         group = factor(group, levels = c("young Spaniard", "Moroccan")),
         subscale = factor(subscale, levels = c("PAST", "FUTURE")),
         participant = factor(participant),
         id = interaction(group, participant, drop = TRUE))

head(d_tidy)

```

# Step 4: Run analysis

## Pre-processing

```{r}

se <- function(x) sd(x, na.rm = TRUE) / sqrt(sum(!is.na(x)))

d_subject <- d_tidy %>%
  group_by(group, participant, subscale) %>%
  summarise(mean_agreement = mean(agreement),
            se = se(agreement),
            .groups = "drop")

d_group <- d_tidy %>%
  group_by(group, subscale) %>%
  summarise(mean_agreement = mean(agreement),
            se = se(agreement),
            .groups = "drop")

```

## Descriptive statistics

Try to recreate Figure 2 (fig2.png, also included in the same folder as this Rmd file):

```{r}

knitr::kable(d_group, digits = 2)

ggplot(d_group, aes(x = group, y = mean_agreement, fill = subscale)) +
  geom_col(position = position_dodge(width = 0.6), width = 0.6) +
  geom_errorbar(aes(ymin = mean_agreement - se, ymax = mean_agreement + se), 
                width = 0.15,
                position = position_dodge(width = 0.6)) +
  scale_x_discrete(labels = c("Moroccan" = "Moroccans", "young Spaniard" = "Spaniards"),) +
  scale_fill_manual(values = c("grey40", "grey80"),
                    labels = c("FUTURE" = "Future-Focused Statements", "PAST" = "Past-Focused Statements")) + 
  coord_cartesian(ylim = c(2, 4)) +
  labs(x = "Group", y = "Rating", fill = "Temporal focus") +
  theme_minimal() +
  theme(legend.position   = "top", legend.direction  = "horizontal", panel.grid.minor  = element_blank())

```

## Inferential statistics

> According to a mixed analysis of variance (ANOVA) with group (Spanish vs. Moroccan) as a between-subjects factor and temporal focus (past vs. future) as a within-subjects factor, temporal focus differed significantly between Spaniards and Moroccans, as indicated by a significant interaction of temporal focus and group, F(1, 78) = 19.12, p = .001, ηp2 = .20 (Fig. 2).

```{r}
# reproduce the above results here

anova <- aov_ez(id = "id",
                    dv = "agreement",
                    between = "group",
                    within = "subscale",
                    data = d_tidy,
                    fun_aggregate = mean)

anova

anova_results <- ezANOVA(data = d_tidy,
                         dv = agreement,
                         wid = id,
                         within = subscale,
                         between = group,
                         detailed = TRUE,
                         type = 3)

anova_results

partial_eta2 <- anova_results$ANOVA
partial_eta2 <- partial_eta %>% mutate(partial_eta2 = SSn / (SSn + SSd))
partial_eta2

```

> Moroccans showed greater agreement with past-focused statements than Spaniards did, t(78) = 4.04, p = .001, 

```{r}
# reproduce the above results here

past <- filter(d_subject, subscale == "PAST")
t.test(mean_agreement ~ relevel(group, ref = "Moroccan"), data = past, var.equal = TRUE)

```

> and Spaniards showed greater agreement with future-focused statements than Moroccans did, t(78) = −3.32, p = .001.(de la Fuente et al., 2014, p. 1685)

```{r}
# reproduce the above results here

future <- filter(d_subject, subscale == "FUTURE")
t.test(mean_agreement ~ relevel(group, ref = "Moroccan"), data = future, var.equal = TRUE)

```

# Step 5: Reflection

Were you able to reproduce the results you attempted to reproduce? If not, what part(s) were you unable to reproduce?

> I was able to reproduce the results after finally switching to the corrected data (although there are very slight rounding differences from some of the stats).

How difficult was it to reproduce your results? 

> It was extremely difficult to reproduce the results because of the data I was using - it was very hard to run the ANOVA because I was using the original raw data, and didn't notice that in the folder there was a corrected set of data (because there were observations originally missing for participant 25 that kept causing errors in the ANOVA which I was able to manually fix, but then caused me to get a different F statistic). It was also difficult to set up the figure/plot to be as similar as possible to the original paper.

What aspects made it difficult? What aspects made it easy?

> Using the raw data made it incredibly difficult (as mentioned above with my issues in running the ANOVA), as this led to a lot of debugging issues with the ANOVA and different stats. 